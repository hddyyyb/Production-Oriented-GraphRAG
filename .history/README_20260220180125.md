# graphrag-lite

End-to-end pipeline for knowledge graphâ€“enhanced RAG on institutional documents.

> è¿™ä¸ªä»“åº“å½“å‰æ˜¯ä¸€å¥—â€œèƒ½è·‘é€šçš„æœ€å°GraphRAGæµæ°´çº¿â€ï¼š
> **æ–‡æ¡£åˆ‡å—â†’å‘é‡ç´¢å¼•(FAISS)â†’å®ä½“/å…³ç³»å›¾(NetworkX)â†’æ£€ç´¢+å›¾æ‰©å±•â†’LLMåŸºäºè¯æ®å›ç­”**ã€‚

---

## ğŸ“¦ Repoç»“æ„

```text
graphrag-lite/
  README.md
  requirements.txt
  .env.example
  data/
    raw_docs/          # æ”¾åŸå§‹æ–‡æ¡£(txt)
    processed/         # åˆ‡å—åçš„jsonl(å½“å‰è„šæœ¬è¾“å‡ºchunks.jsonl)
    index/             # FAISSç´¢å¼• + chunks_meta.json + graph.gpickle
  src/
    config.py
    ingest/
      loader.py
      chunker.py
      embedder.py
      build_index.py
    graph/
      extract.py
      build_graph.py
      store.py
      expand.py
    rag/
      prompt.py
      answer.py
    api/
      server.py
    eval/
      golden.jsonl
      run_eval.py
  scripts/
    ingest.py          # ä¸€é”®ï¼šåˆ‡å—+å‘é‡åŒ–+å»ºFAISS+å»ºå›¾
    build_graph.py     #ï¼ˆå½“å‰ä¸ºç©º/å ä½ï¼‰
    demo.py            # æœ¬åœ°demoï¼šæ£€ç´¢+å›¾æ‰©å±•+LLMå›ç­”
```

---

## âœ… ç¯å¢ƒå‡†å¤‡


```bash
git https://github.com/hddyyyb/Production-Oriented-GraphRAG.git
cd graphrag-lite

python -m venv .venv
# macOS / Linux
source .venv/bin/activate
# Windows PowerShell
# .venv\Scripts\Activate.ps1

# ä¸ºä»€ä¹ˆé€‰3.10ï¼Ÿ
#   PyTorchç¨³å®šæ”¯æŒ
#   sentence-transformerså…¼å®¹å¥½
#   FastAPIå…¼å®¹å¥½
#   ä¼ä¸šæœåŠ¡å™¨æœ€å¸¸ç”¨ç‰ˆæœ¬
#   é¿å…3.12ç”Ÿæ€é—®é¢˜

conda create -n Production-GraphRAG python=3.10 -y
conda activate Production-GraphRAG

python -m pip install -U pip
pip install torch==2.4.1+cu121 torchvision==0.19.1+cu121 torchaudio==2.4.1+cu121 --index-url https://download.pytorch.org/whl/cu121
python -m pip install -r requirements.txt
```

---

## â–¶ï¸ Quick Startï¼ˆæŒ‰ä»“åº“ç°æœ‰è„šæœ¬å¯ç›´æ¥è·‘ï¼‰

### 1ï¼‰å‡†å¤‡æ–‡æ¡£

æŠŠä½ çš„txtæ–‡æ¡£æ”¾åˆ°ï¼š

```text
data/raw_docs/*.txt
```

æ¯ä¸ªæ–‡ä»¶åä¼šä½œä¸º`doc_id`ï¼ˆä¾‹å¦‚`loan_policy.txt`â†’`doc_id="loan_policy"`ï¼‰ã€‚

### 2ï¼‰ä¸€é”®æ„å»ºç´¢å¼•ä¸å›¾

`scripts/ingest.py`ä¼šå®Œæˆï¼š
- è¯»å–`data/raw_docs/*.txt`
- åˆ‡å—å¹¶å†™å…¥`data/processed/chunks.jsonl`
- ç”¨`sentence-transformers/all-MiniLM-L6-v2`åšembedding
- æ„å»ºFAISSç´¢å¼•ï¼š`data/index/chunks.faiss` + `data/index/chunks_meta.json`
- æ„å»ºå›¾å¹¶ä¿å­˜ï¼š`data/index/graph.gpickle`

è¿è¡Œï¼š

```bash
python scripts/ingest.py
```

### 3ï¼‰è¿è¡Œdemoé—®ç­”

`demo.py`ä¼šï¼šåŠ è½½FAISSå’Œå›¾ï¼ŒåšTopKå¬å›+å›¾æ‰©å±•ï¼Œç„¶åç”¨æœ¬åœ°GPT-Neoç”Ÿæˆç­”æ¡ˆã€‚

```bash
python scripts/demo.py
```

ä½ ä¼šçœ‹åˆ°ï¼š
- Retrieved Chunksï¼ˆå¬å›è¯æ®ï¼‰
- Final Answerï¼ˆç”Ÿæˆç­”æ¡ˆï¼‰
- Citationsï¼ˆchunk_idå¼•ç”¨ï¼‰
- Evidence Packï¼ˆè¯æ®åŒ…ï¼‰

---

## ğŸ” GraphRAGæ˜¯æ€ä¹ˆæ¥ä¸Šçš„ï¼Ÿï¼ˆå¯¹åº”æºç ï¼‰

- **å‘é‡å¬å›**ï¼š`src/ingest/build_index.py`æ„å»ºFAISSï¼›`src/rag/answer.py`é‡Œ`index.search()`å¬å›å€™é€‰chunk
- **é¢†åŸŸé—¨æ§(domain gate)**ï¼š`infer_allowed_doc_ids()`å¯¹è´·æ¬¾ç±»é—®é¢˜åšæœ€å°é—¨æ§ï¼Œé¿å…è·¨åŸŸä¹±å¼•è¯æ®
- **å›¾æ‰©å±•**ï¼š`src/rag/answer.py`é‡Œè°ƒç”¨`src/graph/expand.py`ï¼ˆè‹¥å­˜åœ¨å®ç°ï¼‰
- **è¯æ®çº¦æŸç”Ÿæˆ**ï¼špromptè¦æ±‚â€œåªç”¨Evidenceâ€ï¼Œå¹¶è¾“å‡ºæ­¥éª¤+chunk_id

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1ï¼šä¸ºä»€ä¹ˆ`requirements.txt`å’Œ`.env.example`æ˜¯ç©ºçš„ï¼Ÿ
ç›®å‰ä»“åº“è¿˜åœ¨â€œæœ€å°å¯è·‘â€é˜¶æ®µï¼Œå»ºè®®ä½ ä¸‹ä¸€æ­¥æŠŠä¾èµ–è¡¥é½åˆ°`requirements.txt`ï¼Œå¹¶æŠŠæ¨¡å‹/è·¯å¾„é…ç½®æ”¶æ•›åˆ°`src/config.py`æˆ–`.env`ã€‚

### Q2ï¼š`scripts/build_graph.py`ä¸ºä»€ä¹ˆæ˜¯ç©ºçš„ï¼Ÿ
ç°åœ¨å»ºå›¾é€»è¾‘å·²ç»åœ¨`scripts/ingest.py`æœ«å°¾å®Œæˆäº†ï¼ˆè¯»å–`chunks_meta.json`åæ„å›¾å¹¶ä¿å­˜`graph.gpickle`ï¼‰ã€‚
ä½ å¯ä»¥åç»­æŠŠå®ƒæ‹†å‡ºæ¥ï¼Œè®©`build_graph.py`çœŸæ­£æˆä¸ºç‹¬ç«‹æ­¥éª¤ã€‚

---

## ğŸ—ºï¸ ä¸‹ä¸€æ­¥å»ºè®®ï¼ˆå·¥ç¨‹åŒ–å‡çº§æœ€çŸ­è·¯å¾„ï¼‰

1. è¡¥é½`requirements.txt`ï¼ˆé”ç‰ˆæœ¬ï¼‰  
2. æŠŠ`SentenceTransformer`æ¨¡å‹åã€è·¯å¾„ã€top_kç­‰åšæˆé…ç½®é¡¹  
3. æŠŠ`demo.py`é‡Œçš„LLMæŠ½è±¡æˆæ¥å£ï¼ˆæ”¯æŒOpenAI/æœ¬åœ°/ä»»æ„HFæ¨¡å‹ï¼‰  
4. åŠ ä¸€ä¸ªå¯å¤ç°è¯„æµ‹ï¼š`src/eval/run_eval.py` + `golden.jsonl`  
5. åšAPIåŒ–ï¼šå®Œå–„`src/api/server.py`å¹¶æä¾›`uvicorn`å¯åŠ¨æ–¹å¼

---

## License
TBD
